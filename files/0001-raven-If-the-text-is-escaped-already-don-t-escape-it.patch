From 60a577d4ea12f5e61471e259d794c20d7db881e4 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Mon, 22 May 2017 21:45:09 +0100
Subject: [PATCH] raven: If the text is escaped already, don't escape it

This resolves T2905 in Solus.

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 src/raven/notifications_view.vala | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/src/raven/notifications_view.vala b/src/raven/notifications_view.vala
index 98eb95b..6ed827f 100644
--- a/src/raven/notifications_view.vala
+++ b/src/raven/notifications_view.vala
@@ -41,6 +41,11 @@ public static string safe_markup_string(string inp)
         return Markup.escape_text(inp2);
     }
 
+    /* is it already escaped? */
+    if (("&lt;" in inp2) || ("&gt;" in inp2) || ("&amp;" in inp2)) {
+        return inp2;
+    }
+
     /* Ensure it's now sane */
     if (!("&amp;" in inp2)) {
         inp2 = inp2.replace("&", "&amp;");
-- 
2.13.0

