From ebaa08ae2cd582aa5ef9fcd66472ed10e5524f6b Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Wed, 19 Oct 2016 20:33:54 +0100
Subject: [PATCH 5/6] polkit: Fix timestamp problems

This is the same issue as 47275ee115a0503a5e9747bda50c580b06537015

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 polkit/polkitdialog.vala | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/polkit/polkitdialog.vala b/polkit/polkitdialog.vala
index ed4f81e..2ad5686 100644
--- a/polkit/polkitdialog.vala
+++ b/polkit/polkitdialog.vala
@@ -120,7 +120,12 @@ public class AgentDialog : Gtk.Window
         if ((win = get_window()) == null) {
             return;
         }
-        win.focus(Gdk.CURRENT_TIME);
+        Gdk.Display? display = screen.get_display();
+        if (display is Gdk.X11Display) {
+            win.focus(Gdk.X11Display.get_user_time(display));
+        } else {
+            win.focus(Gtk.get_current_event_time());
+        }
         entry_auth.grab_focus();
     }
 
-- 
2.10.1

