From 061a984a14ac7b1b204fbcac438b50750dba302c Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Fri, 21 Oct 2016 20:17:00 +0100
Subject: [PATCH] Ensure all components initialise gettext properly

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 daemon/Makefile.am       | 3 +++
 daemon/main.vala         | 5 +++++
 polkit/Makefile.am       | 3 +++
 polkit/polkitdialog.vala | 5 +++++
 rundialog/Makefile.am    | 6 +++++-
 rundialog/RunDialog.vala | 5 +++++
 6 files changed, 26 insertions(+), 1 deletion(-)

diff --git a/daemon/Makefile.am b/daemon/Makefile.am
index 8197bd9..e5e9558 100644
--- a/daemon/Makefile.am
+++ b/daemon/Makefile.am
@@ -55,6 +55,7 @@ budgie_daemon_CFLAGS = \
 
 budgie_daemon_LDADD = \
 	$(BUDGIE_DAEMON_LIBS) \
+	${top_builddir}/config/libbudgie-config.la \
 	${top_builddir}/libsession/libsession.la \
 	${top_builddir}/theme/libbudgietheme.la
 
@@ -68,6 +69,8 @@ budgie_daemon_VALAFLAGS = \
 	--pkg theme \
 	--pkg libsession \
 	--pkg gdk-x11-3.0 \
+	--pkg budgie-config \
+	--vapidir=${top_srcdir}/config \
 	--vapidir=${top_srcdir}/vapi \
 	--vapidir=${top_srcdir}/theme \
 	--vapidir=${top_srcdir}/libsession \
diff --git a/daemon/main.vala b/daemon/main.vala
index d4bb45a..34d31ee 100644
--- a/daemon/main.vala
+++ b/daemon/main.vala
@@ -18,6 +18,11 @@ public static int main(string[] args)
     Budgie.ServiceManager? manager = null;
     Budgie.EndSessionDialog? end_dialog = null;
 
+    Intl.setlocale(LocaleCategory.ALL, "");
+    Intl.bindtextdomain(Budgie.GETTEXT_PACKAGE, Budgie.LOCALEDIR);
+    Intl.bind_textdomain_codeset(Budgie.GETTEXT_PACKAGE, "UTF-8");
+    Intl.textdomain(Budgie.GETTEXT_PACKAGE);
+
     manager = new Budgie.ServiceManager();
     end_dialog = new Budgie.EndSessionDialog();
 
diff --git a/polkit/Makefile.am b/polkit/Makefile.am
index 4858f64..0cd77f3 100644
--- a/polkit/Makefile.am
+++ b/polkit/Makefile.am
@@ -52,6 +52,7 @@ budgie_polkit_dialog_CFLAGS = \
 
 budgie_polkit_dialog_LDADD = \
 	$(POLKIT_DIALOG_LIBS) \
+	${top_builddir}/config/libbudgie-config.la \
 	${top_builddir}/libsession/libsession.la \
 	${top_builddir}/theme/libbudgietheme.la
 
@@ -67,6 +68,8 @@ budgie_polkit_dialog_VALAFLAGS = \
 	--pkg posix \
 	--pkg theme \
 	--pkg libsession \
+	--pkg budgie-config \
+	--vapidir=${top_srcdir}/config \
 	--vapidir=${top_srcdir}/vapi \
 	--vapidir=${top_srcdir}/theme \
 	--vapidir=${top_srcdir}/libsession \
diff --git a/polkit/polkitdialog.vala b/polkit/polkitdialog.vala
index ed4f81e..5a3b044 100644
--- a/polkit/polkitdialog.vala
+++ b/polkit/polkitdialog.vala
@@ -434,6 +434,11 @@ public static int main(string[] args)
 {
     Gtk.init(ref args);
 
+    Intl.setlocale(LocaleCategory.ALL, "");
+    Intl.bindtextdomain(Budgie.GETTEXT_PACKAGE, Budgie.LOCALEDIR);
+    Intl.bind_textdomain_codeset(Budgie.GETTEXT_PACKAGE, "UTF-8");
+    Intl.textdomain(Budgie.GETTEXT_PACKAGE);
+
     Budgie.Agent? agent = new Budgie.Agent();
     Polkit.Subject? subject = null;
 
diff --git a/rundialog/Makefile.am b/rundialog/Makefile.am
index a61c85e..585ef8a 100644
--- a/rundialog/Makefile.am
+++ b/rundialog/Makefile.am
@@ -6,15 +6,19 @@ budgie_run_dialog_SOURCES = \
 	RunDialog.vala
 
 budgie_run_dialog_CFLAGS = \
-	$(RUNDIALOG_CFLAGS)
+	$(RUNDIALOG_CFLAGS) \
+	$(DECLARATIONS)
 
 budgie_run_dialog_LDADD = \
 	$(RUNDIALOG_LIBS)	  \
+	${top_builddir}/config/libbudgie-config.la \
 	../theme/libbudgietheme.la
 
 budgie_run_dialog_VALAFLAGS = \
 	--pkg gtk+-3.0 \
 	--pkg gio-unix-2.0 \
+	--pkg budgie-config \
+	--vapidir=${top_srcdir}/config \
 	--vapidir=${top_srcdir}/theme \
 	--pkg theme
 
diff --git a/rundialog/RunDialog.vala b/rundialog/RunDialog.vala
index 6728a3d..76b1712 100644
--- a/rundialog/RunDialog.vala
+++ b/rundialog/RunDialog.vala
@@ -386,6 +386,11 @@ public class RunDialogApp : Gtk.Application
 
 public static int main(string[] args)
 {
+    Intl.setlocale(LocaleCategory.ALL, "");
+    Intl.bindtextdomain(Budgie.GETTEXT_PACKAGE, Budgie.LOCALEDIR);
+    Intl.bind_textdomain_codeset(Budgie.GETTEXT_PACKAGE, "UTF-8");
+    Intl.textdomain(Budgie.GETTEXT_PACKAGE);
+
     Budgie.RunDialogApp rd = new Budgie.RunDialogApp();
     return rd.run(args);
 }
-- 
2.10.1

