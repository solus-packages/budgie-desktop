From a92612e2cbedfdefccab26d30c668a8f4ddb7430 Mon Sep 17 00:00:00 2001
From: Ikey Doherty <ikey@solus-project.com>
Date: Fri, 10 Jul 2015 00:15:13 +0100
Subject: [PATCH] wm: Adapt to GSD 3.16 changes (closes issue #204)

Signed-off-by: Ikey Doherty <ikey@solus-project.com>
---
 wm/impl/keys.c                        | 14 +++++++++++++-
 wm/impl/org.gnome.ShellKeyGrabber.xml |  5 ++---
 2 files changed, 15 insertions(+), 4 deletions(-)

diff --git a/wm/impl/keys.c b/wm/impl/keys.c
index 9f9930d..6970d9c 100644
--- a/wm/impl/keys.c
+++ b/wm/impl/keys.c
@@ -159,7 +159,19 @@ static gboolean on_ungrab_accelerator(ShellKeyGrabber *grab,
  */
 static void on_activated(MetaDisplay *display, guint action, guint device_id)
 {
-        shell_key_grabber_emit_accelerator_activated(skel, action, device_id, meta_display_get_current_time(display));
+        GVariantBuilder *builder = NULL;
+        GVariant *params = NULL;
+
+        /* Cheers, flashback guys */
+        builder = g_variant_builder_new(G_VARIANT_TYPE("a{sv}"));
+        g_variant_builder_add(builder, "{sv}", "device-id", g_variant_new_uint32(device_id));
+        g_variant_builder_add(builder, "{sv}", "timestamp", g_variant_new_uint32(0));
+        g_variant_builder_add(builder, "{sv}", "action-mode", g_variant_new_uint32(0));
+
+        params = g_variant_new("a{sv}", builder);
+        g_variant_builder_unref(builder);
+
+        shell_key_grabber_emit_accelerator_activated(skel, action, params);
 }
 
 /**
diff --git a/wm/impl/org.gnome.ShellKeyGrabber.xml b/wm/impl/org.gnome.ShellKeyGrabber.xml
index 8a5c081..a245481 100644
--- a/wm/impl/org.gnome.ShellKeyGrabber.xml
+++ b/wm/impl/org.gnome.ShellKeyGrabber.xml
@@ -16,8 +16,7 @@
     </method>
     <signal name="AcceleratorActivated">
       <arg type="u" name="action"/>
-      <arg type="u" name="device"/>
-      <arg type="u" name="timestamp"/>
+      <arg type="a{sv}" name="parameters"/>
     </signal>
   </interface>
-</node>
\ No newline at end of file
+</node>
-- 
2.4.5

